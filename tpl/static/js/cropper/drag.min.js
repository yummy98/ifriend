var Drag=Class.create();Drag.prototype={initialize:function(drag,options){this.Drag=ica_fc(drag);this._x=this._y=0;this._marginLeft=this._marginTop=0;this._fM=BindAsEventListener(this,this.Move);this._fS=Bind(this,this.Stop);this.SetOptions(options);this.Limit=!!this.options.Limit;this.mxLeft=parseInt(this.options.mxLeft);this.mxRight=parseInt(this.options.mxRight);this.mxTop=parseInt(this.options.mxTop);this.mxBottom=parseInt(this.options.mxBottom);this.LockX=!!this.options.LockX;this.LockY=!!this.options.LockY;this.Lock=!!this.options.Lock;this.onStart=this.options.onStart;this.onMove=this.options.onMove;this.onStop=this.options.onStop;this._Handle=ica_fc(this.options.Handle)||this.Drag;this._mxContainer=ica_fc(this.options.mxContainer)||null;this.Drag.style.position="absolute";if(isIE&&!!this.options.Transparent){with(this._Handle.appendChild(document.createElement("div")).style){width=height="100%";backgroundColor="#fff";filter="alpha(opacity:0)";fontSize=0}}this.Repair();addEventHandler(this._Handle,"mousedown",BindAsEventListener(this,this.Start))},SetOptions:function(a){this.options={Handle:"",Limit:false,mxLeft:0,mxRight:9999,mxTop:0,mxBottom:9999,mxContainer:"",LockX:false,LockY:false,Lock:false,Transparent:false,onStart:function(){},onMove:function(){},onStop:function(){}};Extend(this.options,a||{})},Start:function(a){if(this.Lock){return}this.Repair();this._x=a.clientX-this.Drag.offsetLeft;this._y=a.clientY-this.Drag.offsetTop;this._marginLeft=parseInt(CurrentStyle(this.Drag).marginLeft)||0;this._marginTop=parseInt(CurrentStyle(this.Drag).marginTop)||0;addEventHandler(document,"mousemove",this._fM);addEventHandler(document,"mouseup",this._fS);if(isIE){addEventHandler(this._Handle,"losecapture",this._fS);this._Handle.setCapture()}else{addEventHandler(window,"blur",this._fS);a.preventDefault()}this.onStart()},Repair:function(){if(this.Limit){this.mxRight=Math.max(this.mxRight,this.mxLeft+this.Drag.offsetWidth);this.mxBottom=Math.max(this.mxBottom,this.mxTop+this.Drag.offsetHeight);!this._mxContainer||CurrentStyle(this._mxContainer).position=="relative"||CurrentStyle(this._mxContainer).position=="absolute"||(this._mxContainer.style.position="relative")}},Move:function(e){if(this.Lock){this.Stop();return}window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var g=e.clientX-this._x,f=e.clientY-this._y;if(this.Limit){var d=this.mxLeft,c=this.mxRight,b=this.mxTop,a=this.mxBottom;if(!!this._mxContainer){d=Math.max(d,0);b=Math.max(b,0);c=Math.min(c,this._mxContainer.clientWidth);a=Math.min(a,this._mxContainer.clientHeight)}g=Math.max(Math.min(g,c-this.Drag.offsetWidth),d);f=Math.max(Math.min(f,a-this.Drag.offsetHeight),b)}if(!this.LockX){this.Drag.style.left=g-this._marginLeft+"px"}if(!this.LockY){this.Drag.style.top=f-this._marginTop+"px"}this.onMove()},Stop:function(){removeEventHandler(document,"mousemove",this._fM);removeEventHandler(document,"mouseup",this._fS);if(isIE){removeEventHandler(this._Handle,"losecapture",this._fS);this._Handle.releaseCapture()}else{removeEventHandler(window,"blur",this._fS)}this.onStop()}};